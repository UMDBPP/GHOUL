#include <stdio.h>
#include <stdlib.h>

#include "FIR.h"

#include "input_ascent.h"

FIRFilter fir = {};
float buf[500];
float coeffs[] = {
    -3.27821531666333e-05,   -3.682732121512476e-05,  -4.102860299368283e-05,
    -4.535634621249001e-05,  -4.977711225739541e-05,  -5.4253697639778246e-05,
    -5.874518794572322e-05,  -6.320704559594594e-05,  -6.759123252913742e-05,
    -7.184636870593674e-05,  -7.591792709959921e-05,  -7.974846559370672e-05,
    -8.327789594826333e-05,  -8.644378972462377e-05,  -8.918172077848132e-05,
    -9.142564364024042e-05,  -9.310830680533514e-05,  -9.416169965528803e-05,
    -9.45175314255647e-05,   -9.41077403306072e-05,   -9.286503065201203e-05,
    -9.072343529483363e-05,  -8.761890102172682e-05,  -8.348989328735844e-05,
    -7.82780173185441e-05,   -7.192865182118e-05,     -6.439159144555715e-05,
    -5.56216939093069e-05,   -4.557952746423542e-05,  -3.4232014201814977e-05,
    -2.1553064524160614e-05, -7.52419796488734e-06,   7.86485457083189e-06,
    2.4615572163700012e-05,  4.2720093907307384e-05,  6.216070270014783e-05,
    8.290934788818056e-05,   0.00010492721179926935,  0.00012816432513151847,
    0.00015255923604241885,  0.0001780387376344965,   0.00020451765834555798,
    0.00023189871952780628,  0.000260072464240264,    0.00028891726098376696,
    0.0003182993857779491,   0.0003480731856163265,   0.0003780813259399596,
    0.00040815512434395223,  0.0004381149722758696,   0.00046777084600318927,
    0.0004969229076203326,   0.0005253621963371805,   0.000552871409742946,
    0.000579225774174775,    0.0006041940027425104,   0.0006275393389730005,
    0.0006490206834424943,   0.0006683938001676308,   0.0006854125989279047,
    0.0006998304890990385,   0.0007114017999911927,   0.0007198832621123049,
    0.0007250355432188571,   0.0007266248324780022,   0.0007244244655500106,
    0.0007182165829122673,   0.0007077938132892223,   0.0006929609736305122,
    0.0006735367766952522,   0.0006493555369577435,   0.0006202688652516047,
    0.0005861473423186621,   0.0005468821612284704,   0.000502386728486708,
    0.00045259821355796295,  0.00039747903649274845,  0.000337018283371346,
    0.0002712330393598963,   0.00020016962931771007,  0.00012390475609999784,
    4.2546526967125476e-05,  -4.37646411597136e-05,   -0.00013485524646661355,
    -0.00023051806545859138, -0.0003305116625248408,  -0.0004345600532003991,
    -0.0005423525278441293,  -0.000653543641776545,   -0.0007677533771942609,
    -0.0008845674814032628,  -0.0010035379850947344,  -0.0011241839035280674,
    -0.0012459921225903702,  -0.0013684184707743203,  -0.0014908889771613806,
    -0.0016128013145199132,  -0.0017335264256328193,  -0.0018524103299621486,
    -0.0019687761067440804,  -0.0020819260495925965,  -0.0021911439866793415,
    -0.002295697759556719,   -0.0023948418527067997,  -0.00248782016493597,
    -0.0025738689128002347,  -0.0026522196553443993,  -0.002722102428575633,
    -0.002782748977273625,   -0.0028333960709710088,  -0.0028732888902242,
    -0.0029016844686408252,  -0.002917855175540641,   -0.0029210922236061116,
    -0.0029107091854309202,  -0.002886045502503212,   -0.002846469969868491,
    -0.0027913841795079567,  -0.0027202259053436192,  -0.0026324724127444565,
    -0.0025276436754590108,  -0.0024053054830407163,  -0.0022650724220633057,
    -0.0021066107147448398,  -0.0019296408990099895,  -0.001733940334520056,
    -0.0015193455197876256,  -0.0012857542061653147,  -0.0010331272952539597,
    -0.0007614905071112644,  -0.0004709358075542765,  -0.0001616225838341131,
    0.0001662214409852547,   0.0005122995634954132,   0.000876245732634968,
    0.0012576244657518099,   0.0016559310529087915,   0.0020705920529896127,
    0.00250096608381187,     0.002946344907076788,    0.0034059548075874714,
    0.003878958264756572,    0.004364455913007301,    0.004861488786256467,
    0.00536904084026172,     0.005886041745225169,    0.0064113699396795695,
    0.006943855935348476,    0.007482285861375483,    0.008025405235067277,
    0.008571922945097265,    0.009120515431978128,    0.00966983104953866,
    0.010218494590139519,    0.01076511195543906,     0.011308274953680099,
    0.011846566203716165,    0.012378564125335792,    0.012902847994880064,
    0.01341800304468517,     0.013922625584521472,    0.01441532812294593,
    0.014894744466337052,    0.015359534773343477,    0.015808390542547884,
    0.016240039511328904,    0.016653250444193718,    0.017046837789252398,
    0.01741966618200999,     0.017770654776262027,    0.018098781382590454,
    0.018403086395766644,    0.0186826764932729,      0.018936728088147944,
    0.0191644905204424,      0.0193652889727298,      0.019538527096353665,
    0.019683689336392488,    0.019800342944689065,    0.01988813967170863,
    0.019946817129455775,    0.0199761998191862,      0.0199761998191862,
    0.019946817129455775,    0.01988813967170863,     0.019800342944689065,
    0.019683689336392488,    0.019538527096353665,    0.0193652889727298,
    0.0191644905204424,      0.018936728088147944,    0.0186826764932729,
    0.018403086395766644,    0.018098781382590454,    0.017770654776262027,
    0.01741966618200999,     0.017046837789252398,    0.016653250444193718,
    0.016240039511328904,    0.015808390542547884,    0.015359534773343477,
    0.014894744466337052,    0.01441532812294593,     0.013922625584521472,
    0.01341800304468517,     0.012902847994880064,    0.012378564125335792,
    0.011846566203716165,    0.011308274953680099,    0.01076511195543906,
    0.010218494590139519,    0.00966983104953866,     0.009120515431978128,
    0.008571922945097265,    0.008025405235067277,    0.007482285861375483,
    0.006943855935348476,    0.0064113699396795695,   0.005886041745225169,
    0.00536904084026172,     0.004861488786256467,    0.004364455913007301,
    0.003878958264756572,    0.0034059548075874714,   0.002946344907076788,
    0.00250096608381187,     0.0020705920529896127,   0.0016559310529087915,
    0.0012576244657518099,   0.000876245732634968,    0.0005122995634954132,
    0.0001662214409852547,   -0.0001616225838341131,  -0.0004709358075542765,
    -0.0007614905071112644,  -0.0010331272952539597,  -0.0012857542061653147,
    -0.0015193455197876256,  -0.001733940334520056,   -0.0019296408990099895,
    -0.0021066107147448398,  -0.0022650724220633057,  -0.0024053054830407163,
    -0.0025276436754590108,  -0.0026324724127444565,  -0.0027202259053436192,
    -0.0027913841795079567,  -0.002846469969868491,   -0.002886045502503212,
    -0.0029107091854309202,  -0.0029210922236061116,  -0.002917855175540641,
    -0.0029016844686408252,  -0.0028732888902242,     -0.0028333960709710088,
    -0.002782748977273625,   -0.002722102428575633,   -0.0026522196553443993,
    -0.0025738689128002347,  -0.00248782016493597,    -0.0023948418527067997,
    -0.002295697759556719,   -0.0021911439866793415,  -0.0020819260495925965,
    -0.0019687761067440804,  -0.0018524103299621486,  -0.0017335264256328193,
    -0.0016128013145199132,  -0.0014908889771613806,  -0.0013684184707743203,
    -0.0012459921225903702,  -0.0011241839035280674,  -0.0010035379850947344,
    -0.0008845674814032628,  -0.0007677533771942609,  -0.000653543641776545,
    -0.0005423525278441293,  -0.0004345600532003991,  -0.0003305116625248408,
    -0.00023051806545859138, -0.00013485524646661355, -4.37646411597136e-05,
    4.2546526967125476e-05,  0.00012390475609999784,  0.00020016962931771007,
    0.0002712330393598963,   0.000337018283371346,    0.00039747903649274845,
    0.00045259821355796295,  0.000502386728486708,    0.0005468821612284704,
    0.0005861473423186621,   0.0006202688652516047,   0.0006493555369577435,
    0.0006735367766952522,   0.0006929609736305122,   0.0007077938132892223,
    0.0007182165829122673,   0.0007244244655500106,   0.0007266248324780022,
    0.0007250355432188571,   0.0007198832621123049,   0.0007114017999911927,
    0.0006998304890990385,   0.0006854125989279047,   0.0006683938001676308,
    0.0006490206834424943,   0.0006275393389730005,   0.0006041940027425104,
    0.000579225774174775,    0.000552871409742946,    0.0005253621963371805,
    0.0004969229076203326,   0.00046777084600318927,  0.0004381149722758696,
    0.00040815512434395223,  0.0003780813259399596,   0.0003480731856163265,
    0.0003182993857779491,   0.00028891726098376696,  0.000260072464240264,
    0.00023189871952780628,  0.00020451765834555798,  0.0001780387376344965,
    0.00015255923604241885,  0.00012816432513151847,  0.00010492721179926935,
    8.290934788818056e-05,   6.216070270014783e-05,   4.2720093907307384e-05,
    2.4615572163700012e-05,  7.86485457083189e-06,    -7.52419796488734e-06,
    -2.1553064524160614e-05, -3.4232014201814977e-05, -4.557952746423542e-05,
    -5.56216939093069e-05,   -6.439159144555715e-05,  -7.192865182118e-05,
    -7.82780173185441e-05,   -8.348989328735844e-05,  -8.761890102172682e-05,
    -9.072343529483363e-05,  -9.286503065201203e-05,  -9.41077403306072e-05,
    -9.45175314255647e-05,   -9.416169965528803e-05,  -9.310830680533514e-05,
    -9.142564364024042e-05,  -8.918172077848132e-05,  -8.644378972462377e-05,
    -8.327789594826333e-05,  -7.974846559370672e-05,  -7.591792709959921e-05,
    -7.184636870593674e-05,  -6.759123252913742e-05,  -6.320704559594594e-05,
    -5.874518794572322e-05,  -5.4253697639778246e-05, -4.977711225739541e-05,
    -4.535634621249001e-05,  -4.102860299368283e-05,  -3.682732121512476e-05,
    -3.27821531666333e-05};

int main() { /* Initialise PID controller */
  FIRFilter_Init(&fir, coeffs, buf, 364);

  FILE *f = fopen("file.csv", "w");
  if (f == NULL) {
    printf("Error opening file!\n");
    exit(1);
  }

  for (int i = 0; i < (sizeof(input) / 4); i++) {
    float output = FIRFilter_Update(&fir, input[i]);
    fprintf(f, "%f\n", output);
  }

  fclose(f);

  return 0;
}
